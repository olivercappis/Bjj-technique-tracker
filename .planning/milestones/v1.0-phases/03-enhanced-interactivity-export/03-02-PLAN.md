---
phase: 03-enhanced-interactivity-export
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/game-plan/technique-detail-sheet.tsx
  - src/components/game-plan/position-browser-sheet.tsx
  - src/components/game-plan/flowchart-view.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking a technique node opens a right-side Sheet showing its full details (description, steps, tips, difficulty, type)"
    - "Clicking a position node opens a right-side Sheet listing all techniques from that position with Add to Plan toggles"
    - "Clicking the remove button on a technique node does NOT open the Sheet (stopPropagation preserved)"
    - "Sheets are dismissible by clicking outside or clicking the X button"
  artifacts:
    - path: "src/components/game-plan/technique-detail-sheet.tsx"
      provides: "Sheet panel displaying technique details (mirrors technique page content)"
    - path: "src/components/game-plan/position-browser-sheet.tsx"
      provides: "Sheet panel displaying all techniques from a position with Add to Plan buttons"
    - path: "src/components/game-plan/flowchart-view.tsx"
      provides: "onNodeClick handler routing to technique or position Sheet based on node type"
  key_links:
    - from: "src/components/game-plan/flowchart-view.tsx"
      to: "src/components/game-plan/technique-detail-sheet.tsx"
      via: "onNodeClick sets selectedNode state, Sheet controlled by selectedNode.type === 'technique'"
      pattern: "selectedNode.*technique"
    - from: "src/components/game-plan/flowchart-view.tsx"
      to: "src/components/game-plan/position-browser-sheet.tsx"
      via: "onNodeClick sets selectedNode state, Sheet controlled by selectedNode.type === 'position'"
      pattern: "selectedNode.*position"
    - from: "src/components/game-plan/position-browser-sheet.tsx"
      to: "src/components/game-plan/add-to-plan-button.tsx"
      via: "Each technique row renders AddToPlanButton for that technique"
      pattern: "AddToPlanButton"
---

<objective>
Add click-to-detail panels for technique and position nodes in the flowchart.

Purpose: Users can click any technique node to see its full details (description, steps, tips) without leaving the flowchart, and click any position node to browse and add more techniques from that position — making the flowchart an interactive planning surface.

Output: TechniqueDetailSheet, PositionBrowserSheet, onNodeClick wiring in FlowchartView.
</objective>

<execution_context>
@C:/Users/cappi/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/cappi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-enhanced-interactivity-export/03-RESEARCH.md
@.planning/phases/03-enhanced-interactivity-export/03-01-SUMMARY.md

@src/components/game-plan/flowchart-view.tsx
@src/components/ui/sheet.tsx
@src/pages/technique.tsx
@src/components/game-plan/add-to-plan-button.tsx
@src/data/index.ts
@src/types/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TechniqueDetailSheet and PositionBrowserSheet components</name>
  <files>src/components/game-plan/technique-detail-sheet.tsx, src/components/game-plan/position-browser-sheet.tsx</files>
  <action>
**technique-detail-sheet.tsx (new file):**
1. Props: `{ techniqueId: string; open: boolean; onOpenChange: (open: boolean) => void }`.
2. Look up technique via `techniques.find(t => t.id === techniqueId)` from `@/data`. If not found, render nothing inside Sheet.
3. Also look up the position via `positions.find(p => p.id === technique.positionId)` for context.
4. Use `Sheet`, `SheetContent` (side="right"), `SheetHeader`, `SheetTitle`, `SheetDescription` from `@/components/ui/sheet`.
5. Content mirrors the technique page layout (from `src/pages/technique.tsx`) but in compact Sheet form:
   - Header: technique name as SheetTitle, position name as SheetDescription.
   - Below header: TypeBadge + DifficultyIndicator + AddToPlanButton in a flex row.
   - Tags row: technique.tags as Badge components.
   - Description paragraph.
   - "Steps" section: ordered list with numbered circles (same styling as technique page).
   - "Tips" section (if tips.length > 0): Lightbulb icon header, bullet list (same amber styling as technique page).
6. Body content should be in a `<div className="overflow-y-auto flex-1 px-4 pb-4">` for scrolling.
7. Import TypeBadge from `@/components/type-badge`, DifficultyIndicator from `@/components/difficulty-indicator`, AddToPlanButton from `@/components/game-plan/add-to-plan-button`, Badge from `@/components/ui/badge`, Lightbulb from `lucide-react`.

**position-browser-sheet.tsx (new file):**
1. Props: `{ positionId: string; open: boolean; onOpenChange: (open: boolean) => void }`.
2. Look up position via `positions.find(p => p.id === positionId)` from `@/data`. Get techniques via `getTechniquesByPosition(positionId)` from `@/data`.
3. Use Sheet/SheetContent (side="right"), SheetHeader, SheetTitle, SheetDescription.
4. SheetTitle: position name. SheetDescription: "Browse and add techniques from this position".
5. Body: scrollable list of all techniques from this position, each as a row:
   - Technique name (text-sm font-medium).
   - TypeBadge for technique type.
   - DifficultyIndicator (no label, compact).
   - AddToPlanButton for each technique.
6. Each row: `flex items-center justify-between rounded-lg border border-border/50 bg-card p-3 gap-3`.
7. If no techniques exist for the position (unlikely but defensive), show a muted message.
8. Import same dependencies as above plus `getTechniquesByPosition` from `@/data`.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Both files exist and export their components.</verify>
  <done>TechniqueDetailSheet displays full technique details in a right-side Sheet. PositionBrowserSheet lists all techniques from a position with Add to Plan buttons.</done>
</task>

<task type="auto">
  <name>Task 2: Wire onNodeClick in FlowchartView to open Sheets</name>
  <files>src/components/game-plan/flowchart-view.tsx</files>
  <action>
1. Add imports for `TechniqueDetailSheet` and `PositionBrowserSheet` from their new files.

2. Add state in FlowchartView:
   ```typescript
   const [selectedNode, setSelectedNode] = useState<{ type: "technique" | "position"; id: string } | null>(null);
   ```

3. Create `onNodeClick` callback (wrapped in `useCallback`, deps `[]`):
   ```typescript
   const onNodeClick = useCallback((_e: React.MouseEvent, node: Node) => {
     if (node.type === "technique") {
       setSelectedNode({ type: "technique", id: (node.data as { techniqueId: string }).techniqueId });
     } else if (node.type === "position") {
       setSelectedNode({ type: "position", id: (node.data as { positionId: string }).positionId });
     }
   }, []);
   ```

4. Pass `onNodeClick={onNodeClick}` to `<ReactFlow>`.

5. Render both Sheets OUTSIDE the `<div>` that wraps `<ReactFlow>`, as sibling elements. They are controlled components:
   ```tsx
   <TechniqueDetailSheet
     techniqueId={selectedNode?.type === "technique" ? selectedNode.id : ""}
     open={selectedNode?.type === "technique"}
     onOpenChange={(open) => { if (!open) setSelectedNode(null); }}
   />
   <PositionBrowserSheet
     positionId={selectedNode?.type === "position" ? selectedNode.id : ""}
     open={selectedNode?.type === "position"}
     onOpenChange={(open) => { if (!open) setSelectedNode(null); }}
   />
   ```

6. The Sheets render in a portal (Radix SheetContent uses Portal), so placing them outside the ReactFlow div is correct and avoids z-index conflicts.

7. **Verify the existing remove button on TechniqueNode still has `e.stopPropagation()`** — this prevents clicking remove from also triggering onNodeClick. Per research, this is already in place (added in Phase 02-03). Do NOT remove it.

8. Wrap FlowchartView's return in a fragment `<>...</>` to accommodate the sibling Sheets alongside the main div.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Run `npm run dev`, open game plan flowchart, click a technique node — Sheet opens with full details. Click a position node — Sheet opens with technique browser. Click remove button on technique node — technique is removed, Sheet does NOT open. Click outside Sheet — it closes.</verify>
  <done>Clicking technique nodes opens detail Sheet, clicking position nodes opens browser Sheet. Remove button does not trigger Sheet. Sheets are dismissible.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. Click a technique node in flowchart: right-side Sheet slides in showing technique name, type badge, difficulty, description, steps, tips
3. Click a position node: right-side Sheet slides in showing position name and all techniques with Add to Plan buttons
4. Click the remove "x" button on a technique node: technique is removed from plan, Sheet does NOT open
5. Click outside the Sheet or click X: Sheet closes, selectedNode resets to null
6. Sheets scroll correctly when content is longer than viewport
7. Hover highlighting from Plan 03-01 still works correctly (no regression)
</verification>

<success_criteria>
- TechniqueDetailSheet shows all technique fields (name, type, difficulty, description, steps, tips, tags)
- PositionBrowserSheet shows all techniques from a position with AddToPlanButton
- onNodeClick routes correctly by node type
- Remove button stopPropagation prevents Sheet opening
- INTX-01 (technique detail on click) and INTX-02 (position browsing on click) requirements met
</success_criteria>

<output>
After completion, create `.planning/phases/03-enhanced-interactivity-export/03-02-SUMMARY.md`
</output>
