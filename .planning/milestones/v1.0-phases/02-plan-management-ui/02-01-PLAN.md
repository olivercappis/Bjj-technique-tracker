---
phase: 02-plan-management-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/game-plan.ts
  - src/stores/game-plan-store.ts
  - src/components/ui/dropdown-menu.tsx
  - src/components/ui/input.tsx
  - src/components/ui/alert-dialog.tsx
autonomous: true

must_haves:
  truths:
    - "GamePlan type includes optional tags field typed as PlanTag[]"
    - "Store exposes duplicateGamePlan, addTag, and removeTag actions"
    - "Duplicating a plan creates a copy with ' (copy)' suffix, copies techniqueIds and tags, clears nodePositions, and sets the copy as active"
    - "Adding/removing tags updates the plan's updatedAt timestamp"
    - "shadcn DropdownMenu, Input, and AlertDialog components are available in src/components/ui/"
  artifacts:
    - path: "src/types/game-plan.ts"
      provides: "PlanTag type, PLAN_TAGS const, GamePlan with optional tags"
      contains: "PLAN_TAGS"
    - path: "src/stores/game-plan-store.ts"
      provides: "duplicateGamePlan, addTag, removeTag actions"
      contains: "duplicateGamePlan"
    - path: "src/components/ui/dropdown-menu.tsx"
      provides: "DropdownMenu Radix primitive"
    - path: "src/components/ui/input.tsx"
      provides: "Input component"
    - path: "src/components/ui/alert-dialog.tsx"
      provides: "AlertDialog Radix primitive"
  key_links:
    - from: "src/stores/game-plan-store.ts"
      to: "src/types/game-plan.ts"
      via: "import PlanTag type"
      pattern: "import.*PlanTag.*from.*game-plan"
---

<objective>
Extend the data layer and install UI primitives for Phase 2 plan management.

Purpose: All UI components in subsequent plans depend on the GamePlan type having tags, the store having duplicate/tag actions, and shadcn primitives (DropdownMenu, Input, AlertDialog) being available. This plan establishes the foundation without any UI work.

Output: Extended type, extended store, three new shadcn UI components.
</objective>

<execution_context>
@C:/Users/cappi/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/cappi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-plan-management-ui/02-RESEARCH.md
@src/types/game-plan.ts
@src/stores/game-plan-store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend GamePlan type and store with duplicate + tag actions</name>
  <files>src/types/game-plan.ts, src/stores/game-plan-store.ts</files>
  <action>
**1. Extend `src/types/game-plan.ts`:**

Add `PLAN_TAGS` const and `PlanTag` type before the `GamePlan` interface:

```typescript
export const PLAN_TAGS = ["gi", "no-gi", "competition"] as const;
export type PlanTag = (typeof PLAN_TAGS)[number];
```

Add `tags?: PlanTag[]` to the `GamePlan` interface (optional to avoid migration — existing persisted plans won't have it).

**2. Extend `src/stores/game-plan-store.ts`:**

Import `PlanTag` from `@/types/game-plan`.

Add three new actions to the `GamePlanState` interface:
- `duplicateGamePlan: (id: string) => string | null`
- `addTag: (planId: string, tag: PlanTag) => void`
- `removeTag: (planId: string, tag: PlanTag) => void`

Implement `duplicateGamePlan`:
- Find source plan by id; return null if not found
- Generate new id via existing `generateId()`
- Create copy with: spread source, new id, name `${source.name} (copy)`, fresh `createdAt`/`updatedAt` (Date.now()), `nodePositions: undefined` (fresh layout), `tags: source.tags ?? []`
- Append to `gamePlans` array, set `activeGamePlanId` to new id
- Return new id

Implement `addTag`:
- Map over gamePlans, find plan by id
- Only add tag if not already present: `!(p.tags ?? []).includes(tag)`
- Set `tags: [...(p.tags ?? []), tag]`, update `updatedAt`

Implement `removeTag`:
- Map over gamePlans, find plan by id
- Filter tag out: `tags: (p.tags ?? []).filter((t) => t !== tag)`, update `updatedAt`

Do NOT bump the store version — `tags` is optional, so existing persisted data works without migration.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Grep for `duplicateGamePlan` and `addTag` in the store file to confirm they exist.</verify>
  <done>GamePlan type has optional `tags?: PlanTag[]`. Store has `duplicateGamePlan`, `addTag`, `removeTag` actions. TypeScript compiles clean.</done>
</task>

<task type="auto">
  <name>Task 2: Add shadcn DropdownMenu, Input, and AlertDialog components</name>
  <files>src/components/ui/dropdown-menu.tsx, src/components/ui/input.tsx, src/components/ui/alert-dialog.tsx</files>
  <action>
Run the shadcn CLI to add three components:

```bash
npx shadcn@latest add dropdown-menu input alert-dialog --yes
```

The `--yes` flag skips confirmation prompts. The project's `components.json` has style "new-york", `rsc: false`, and aliases configured. The CLI will create files in `src/components/ui/`.

After the command completes:
1. Verify all three files exist in `src/components/ui/`
2. Check that imports use `radix-ui/react-*` subpath imports (compatible with the project's `radix-ui` unified package v1.4.3)
3. Run `npx tsc --noEmit` to confirm no type errors

If the shadcn CLI fails or produces incompatible imports, manually create the components using the Radix primitives from the `radix-ui` unified package with the same API surface as shadcn new-york style.
  </action>
  <verify>Files exist: `ls src/components/ui/dropdown-menu.tsx src/components/ui/input.tsx src/components/ui/alert-dialog.tsx`. Run `npx tsc --noEmit` — no errors.</verify>
  <done>Three shadcn UI components installed and compiling: DropdownMenu, Input, AlertDialog.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes with zero errors
- `src/types/game-plan.ts` exports `PLAN_TAGS`, `PlanTag`, and `GamePlan` with optional `tags`
- `src/stores/game-plan-store.ts` exports store with `duplicateGamePlan`, `addTag`, `removeTag`
- `src/components/ui/dropdown-menu.tsx`, `input.tsx`, `alert-dialog.tsx` all exist
</verification>

<success_criteria>
Data layer and UI primitives are ready for plan management UI construction. TypeScript compiles clean. No runtime changes yet — pure foundation.
</success_criteria>

<output>
After completion, create `.planning/phases/02-plan-management-ui/02-01-SUMMARY.md`
</output>
