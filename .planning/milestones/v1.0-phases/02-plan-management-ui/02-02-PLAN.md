---
phase: 02-plan-management-ui
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/game-plan/plan-selector.tsx
  - src/components/game-plan/plan-create-dialog.tsx
  - src/components/game-plan/plan-rename-dialog.tsx
  - src/components/game-plan/plan-delete-dialog.tsx
  - src/pages/game-plan.tsx
autonomous: true

must_haves:
  truths:
    - "User can see a dropdown in the game plan page header showing the active plan name"
    - "User can switch between plans via the dropdown and see the correct flowchart/list update"
    - "User can create a new plan with a custom name via a dialog"
    - "User can rename an existing plan via a dialog with the current name pre-filled"
    - "User can delete a plan after confirming in a destructive AlertDialog"
    - "User can duplicate a plan from the dropdown actions"
    - "New plan is set as active after creation or duplication"
  artifacts:
    - path: "src/components/game-plan/plan-selector.tsx"
      provides: "Plan switching dropdown with per-plan action buttons"
      contains: "PlanSelector"
    - path: "src/components/game-plan/plan-create-dialog.tsx"
      provides: "Dialog for creating a new named plan"
      contains: "PlanCreateDialog"
    - path: "src/components/game-plan/plan-rename-dialog.tsx"
      provides: "Dialog for renaming a plan"
      contains: "PlanRenameDialog"
    - path: "src/components/game-plan/plan-delete-dialog.tsx"
      provides: "AlertDialog for confirming plan deletion"
      contains: "PlanDeleteDialog"
    - path: "src/pages/game-plan.tsx"
      provides: "PlanSelector integrated into page header"
      contains: "PlanSelector"
  key_links:
    - from: "src/components/game-plan/plan-selector.tsx"
      to: "src/stores/game-plan-store.ts"
      via: "useGamePlanStore selectors for gamePlans, activeGamePlanId, setActiveGamePlan, duplicateGamePlan"
      pattern: "useGamePlanStore"
    - from: "src/components/game-plan/plan-create-dialog.tsx"
      to: "src/stores/game-plan-store.ts"
      via: "createGamePlan and setActiveGamePlan"
      pattern: "createGamePlan"
    - from: "src/pages/game-plan.tsx"
      to: "src/components/game-plan/plan-selector.tsx"
      via: "PlanSelector component in header"
      pattern: "import.*PlanSelector"
---

<objective>
Build the plan selector dropdown and CRUD dialog components, then wire them into the game plan page.

Purpose: This is the core user-facing plan management UI. Users need to create, switch, rename, delete, and duplicate game plans — all accessible from the game plan page header.

Output: PlanSelector component with integrated CRUD dialogs, wired into game-plan page header.
</objective>

<execution_context>
@C:/Users/cappi/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/cappi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-plan-management-ui/02-RESEARCH.md
@.planning/phases/02-plan-management-ui/02-01-SUMMARY.md
@src/stores/game-plan-store.ts
@src/pages/game-plan.tsx
@src/components/ui/dropdown-menu.tsx
@src/components/ui/dialog.tsx
@src/components/ui/alert-dialog.tsx
@src/components/ui/input.tsx
@src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create CRUD dialog components for plan management</name>
  <files>src/components/game-plan/plan-create-dialog.tsx, src/components/game-plan/plan-rename-dialog.tsx, src/components/game-plan/plan-delete-dialog.tsx</files>
  <action>
**1. Create `plan-create-dialog.tsx`:**

Controlled dialog (open/onOpenChange props). Contains:
- A `<form>` with an `<Input>` for the plan name (placeholder: "e.g. Competition Pressure Passing")
- `autoFocus` on the input
- Submit button disabled when name is empty/whitespace
- On submit: call `createGamePlan(name.trim())`, then `setActiveGamePlan(id)` with the returned id, reset name state, close dialog
- Use existing `Dialog`, `DialogContent`, `DialogHeader`, `DialogTitle`, `DialogFooter` from `@/components/ui/dialog`
- Use `Input` from `@/components/ui/input` and `Button` from `@/components/ui/button`

Props interface:
```typescript
interface PlanCreateDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
}
```

**2. Create `plan-rename-dialog.tsx`:**

Controlled dialog. Props include `planId` and `currentName`. Contains:
- A `<form>` with an `<Input>` pre-filled with `currentName`
- On submit: call `renameGamePlan(planId, name.trim())`, close dialog
- Submit disabled when name is empty/whitespace or unchanged from `currentName`
- Reset the draft name to `currentName` when dialog opens (use useEffect on `open` + `currentName`)

Props interface:
```typescript
interface PlanRenameDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  planId: string;
  currentName: string;
}
```

**3. Create `plan-delete-dialog.tsx`:**

Use `AlertDialog` (NOT regular Dialog) for destructive action semantics:
- `AlertDialogContent` with `AlertDialogHeader` showing title "Delete \"{planName}\"?"
- `AlertDialogDescription`: "This will permanently delete this game plan and all its technique selections. This action cannot be undone."
- `AlertDialogFooter` with `AlertDialogCancel` ("Cancel") and `AlertDialogAction` ("Delete Plan")
- The delete action button uses destructive styling: `className="bg-destructive text-destructive-foreground hover:bg-destructive/90"`
- `onConfirm` prop called on delete action click

Props interface:
```typescript
interface PlanDeleteDialogProps {
  open: boolean;
  onOpenChange: (open: boolean) => void;
  planName: string;
  onConfirm: () => void;
}
```

All three components use Zustand selectors from `useGamePlanStore` (not destructured getActiveGamePlan calls) to stay consistent with Phase 1 patterns.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. All three files exist and export their named components.</verify>
  <done>Three dialog components created: PlanCreateDialog, PlanRenameDialog, PlanDeleteDialog. All compile clean.</done>
</task>

<task type="auto">
  <name>Task 2: Create PlanSelector dropdown and wire into game plan page</name>
  <files>src/components/game-plan/plan-selector.tsx, src/pages/game-plan.tsx</files>
  <action>
**1. Create `plan-selector.tsx`:**

A self-contained component managing all dialog open/close states internally. Structure:

- **Trigger:** A `Button variant="outline"` showing active plan name + `ChevronDown` icon. If no active plan, show "Select Plan".
- **DropdownMenuContent** (align="start", w-64):
  - Map over `gamePlans` to render `DropdownMenuItem` for each plan
  - Active plan gets `bg-accent` highlight
  - Each plan item shows: plan name (left), then action icon buttons (right-aligned, flex row)
  - Action icons per plan (all from lucide-react, h-4 w-4):
    - `Pencil` — opens PlanRenameDialog for that plan
    - `Copy` — calls `duplicateGamePlan(plan.id)` directly (no dialog needed)
    - `Trash2` — opens PlanDeleteDialog for that plan
  - Action buttons use `e.stopPropagation()` + `e.preventDefault()` to prevent the DropdownMenuItem onSelect from firing when clicking actions
  - `DropdownMenuSeparator` after plan list
  - `DropdownMenuItem` at bottom: `Plus` icon + "New Plan" — opens PlanCreateDialog

- **Dialog state management:** Use local `useState` for each:
  - `createOpen: boolean`
  - `renameTarget: { id: string; name: string } | null` (null = closed)
  - `deleteTarget: { id: string; name: string } | null` (null = closed)

- **Zustand selectors:** Read `gamePlans` and `activeGamePlanId` via individual selectors. Get `setActiveGamePlan` and `duplicateGamePlan` from the store.

- **Render dialogs outside the DropdownMenu** to avoid portal conflicts:
  ```tsx
  <>
    <DropdownMenu>...</DropdownMenu>
    <PlanCreateDialog open={createOpen} onOpenChange={setCreateOpen} />
    {renameTarget && <PlanRenameDialog ... />}
    {deleteTarget && <PlanDeleteDialog ... />}
  </>
  ```

- **Delete handler:** Call `deleteGamePlan(deleteTarget.id)`, then `setDeleteTarget(null)`.

**2. Update `src/pages/game-plan.tsx`:**

- Import `PlanSelector` from `@/components/game-plan/plan-selector`
- In the header section, add `<PlanSelector />` below the plan name heading area. Place it in the `flex items-center gap-3` div, either beside the plan name or as a separate row below the h1.
- Recommended placement: Replace the static `<h1>` plan name with the PlanSelector button (the selector already shows the plan name). Keep the technique/position count below it.
- Remove the static `{activePlan?.name ?? "Game Plan"}` from the h1 since PlanSelector now displays the active plan name.
- Keep the existing `useEffect` for auto-creating "My Game Plan" on first load.

Import icons used in PlanSelector: `ChevronDown`, `Plus`, `Pencil`, `Copy`, `Trash2` from `lucide-react`.
  </action>
  <verify>Run `npx tsc --noEmit` — no type errors. Run `npm run build` to verify the full build succeeds. Visually confirm in dev server (`npm run dev`) that the plan selector appears in the game plan page header.</verify>
  <done>PlanSelector dropdown with CRUD actions is visible in the game plan page header. Users can create, switch, rename, delete, and duplicate game plans. New/duplicated plans become active immediately.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run build` succeeds
- PlanSelector renders in game plan page header showing active plan name
- Clicking PlanSelector opens dropdown listing all plans
- "New Plan" item opens create dialog
- Per-plan pencil icon opens rename dialog
- Per-plan trash icon opens delete AlertDialog
- Per-plan copy icon duplicates plan immediately
- Switching plans updates flowchart and list view
</verification>

<success_criteria>
All plan management CRUD operations (create, read/switch, rename, delete, duplicate) are accessible from the game plan page via the PlanSelector dropdown. Users can manage multiple game plans without any code or localStorage intervention.
</success_criteria>

<output>
After completion, create `.planning/phases/02-plan-management-ui/02-02-SUMMARY.md`
</output>
