---
phase: 02-plan-management-ui
plan: 03
type: execute
wave: 3
depends_on: ["02-01", "02-02"]
files_modified:
  - src/components/game-plan/plan-tag-editor.tsx
  - src/components/game-plan/plan-selector.tsx
  - src/components/game-plan/technique-node.tsx
  - src/components/game-plan/list-view.tsx
  - src/components/game-plan/empty-state.tsx
autonomous: false

must_haves:
  truths:
    - "User can toggle gi, no-gi, and competition tags on the active plan"
    - "Tags display as small badges in the plan selector dropdown next to each plan name"
    - "User can remove a technique from the flowchart by clicking a remove button on the technique node"
    - "User can remove a technique from the list view by clicking a remove button on the technique row"
    - "Remove buttons on technique nodes do not trigger React Flow drag behavior"
    - "Empty state shows guidance text and a link to browse techniques"
  artifacts:
    - path: "src/components/game-plan/plan-tag-editor.tsx"
      provides: "Inline tag toggle UI with gi, no-gi, competition badges"
      contains: "PlanTagEditor"
    - path: "src/components/game-plan/technique-node.tsx"
      provides: "TechniqueNode with hover-visible remove button"
      contains: "nodrag"
    - path: "src/components/game-plan/list-view.tsx"
      provides: "ListView with remove button per technique row"
      contains: "removeTechnique"
  key_links:
    - from: "src/components/game-plan/plan-tag-editor.tsx"
      to: "src/stores/game-plan-store.ts"
      via: "addTag and removeTag actions"
      pattern: "addTag|removeTag"
    - from: "src/components/game-plan/technique-node.tsx"
      to: "src/stores/game-plan-store.ts"
      via: "removeTechnique action"
      pattern: "removeTechnique"
    - from: "src/components/game-plan/list-view.tsx"
      to: "src/stores/game-plan-store.ts"
      via: "removeTechnique action"
      pattern: "removeTechnique"
---

<objective>
Add tag management, per-technique removal from flowchart and list view, and verify the complete Phase 2 plan management UI.

Purpose: Tags let users organize plans by context (gi, no-gi, competition). Technique removal (INTX-03) lets users refine their plan directly from the visualization. Together with plans 02-01 and 02-02, this completes all Phase 2 requirements.

Output: PlanTagEditor component, updated TechniqueNode and ListView with remove buttons, updated PlanSelector with tag display, human verification of the full Phase 2 feature set.
</objective>

<execution_context>
@C:/Users/cappi/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/cappi/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-plan-management-ui/02-RESEARCH.md
@.planning/phases/02-plan-management-ui/02-01-SUMMARY.md
@.planning/phases/02-plan-management-ui/02-02-SUMMARY.md
@src/stores/game-plan-store.ts
@src/types/game-plan.ts
@src/components/game-plan/plan-selector.tsx
@src/components/game-plan/technique-node.tsx
@src/components/game-plan/list-view.tsx
@src/components/game-plan/empty-state.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PlanTagEditor and wire tags into PlanSelector</name>
  <files>src/components/game-plan/plan-tag-editor.tsx, src/components/game-plan/plan-selector.tsx</files>
  <action>
**1. Create `plan-tag-editor.tsx`:**

A small inline component that renders 3 toggle-style badge buttons for the allowed tags (gi, no-gi, competition).

Props: `{ planId: string }`

Implementation:
- Import `PLAN_TAGS` from `@/types/game-plan`
- Import `useGamePlanStore` for `addTag`, `removeTag`, and reading the plan's current tags
- Read the plan's tags: `const plan = useGamePlanStore((s) => s.gamePlans.find((p) => p.id === planId))`
- Read actions: `const addTag = useGamePlanStore((s) => s.addTag)` and `removeTag` similarly
- Render a `div` with `flex gap-1.5 flex-wrap`
- For each tag in `PLAN_TAGS`, render a `<button>`:
  - Determine active state: `(plan?.tags ?? []).includes(tag)`
  - Active styling: `bg-primary/15 border-primary/40 text-primary`
  - Inactive styling: `bg-transparent border-border text-muted-foreground hover:border-primary/30`
  - Base classes: `text-[10px] px-1.5 py-0 rounded-full border transition-colors`
  - onClick: toggle — if active, `removeTag(planId, tag)`, else `addTag(planId, tag)`

**2. Update `plan-selector.tsx` to show tags and render PlanTagEditor:**

Two changes to the PlanSelector dropdown:

a) **Read-only tag badges in each plan's dropdown item:**
After the plan name in each `DropdownMenuItem`, render small read-only tag badges:
```tsx
{(plan.tags ?? []).length > 0 && (
  <span className="flex gap-1 ml-1">
    {(plan.tags ?? []).map((tag) => (
      <span key={tag} className="text-[9px] px-1 py-0 rounded-full bg-muted text-muted-foreground">
        {tag}
      </span>
    ))}
  </span>
)}
```

b) **Tag editing for the active plan:**
Below the PlanSelector dropdown trigger (not inside the dropdown content), render the `PlanTagEditor` for the active plan. This shows the toggleable tag badges inline in the page header area, always visible for the active plan:
```tsx
{activeGamePlanId && <PlanTagEditor planId={activeGamePlanId} />}
```

Place this after the DropdownMenu closing tag but inside the outer fragment, adjacent to the selector button so it appears as a row of small tag toggles below the plan name selector.
  </action>
  <verify>Run `npx tsc --noEmit` — no errors. Check that `PlanTagEditor` is exported and imported in `plan-selector.tsx`.</verify>
  <done>Tag badges show in plan selector dropdown for each plan. Active plan has toggleable tag editor below the selector. Tags persist via Zustand store.</done>
</task>

<task type="auto">
  <name>Task 2: Add technique remove buttons to TechniqueNode and ListView</name>
  <files>src/components/game-plan/technique-node.tsx, src/components/game-plan/list-view.tsx</files>
  <action>
**1. Update `technique-node.tsx` — add hover-visible remove button:**

Import `useGamePlanStore` from `@/stores/game-plan-store`.

Inside `TechniqueNodeComponent`, get the remove action:
```typescript
const removeTechnique = useGamePlanStore((s) => s.removeTechnique);
```

Add a wrapper `div` around the existing content with `className="relative group"`. Merge this into the existing outermost div (which already has `rounded-full px-3 py-1.5...`). Add `group` to its existing className.

After the `{data.name}` text, add the remove button:
```tsx
<button
  className="nodrag absolute -top-1.5 -right-1.5 hidden group-hover:flex h-4 w-4 items-center justify-center rounded-full bg-destructive text-destructive-foreground text-[10px] transition-opacity"
  onClick={(e) => {
    e.stopPropagation();
    removeTechnique(data.techniqueId);
  }}
  title="Remove from plan"
>
  x
</button>
```

Critical details:
- `nodrag` class prevents React Flow from initiating drag on the button
- `e.stopPropagation()` prevents the click from propagating to React Flow's node click handler
- `hidden group-hover:flex` makes it appear only on hover
- `absolute -top-1.5 -right-1.5` positions it at the top-right corner of the pill
- Use plain "x" text (Unicode multiplication sign can also work) — no need for a lucide icon at this tiny size

**2. Update `list-view.tsx` — add remove button per technique row:**

Import `useGamePlanStore` from `@/stores/game-plan-store`.
Import `Trash2` from `lucide-react`.

At the top of the `ListView` component, get the action:
```typescript
const removeTechnique = useGamePlanStore((s) => s.removeTechnique);
```

For **submissions** (the `<span>` tags rendered in the flex wrap), wrap each submission in a `group` div and add a remove button:
```tsx
{submissions.map((sub) => (
  <span
    key={sub.id}
    className="text-xs bg-red-500/15 text-red-400 border border-red-500/30 rounded-full px-2 py-0.5 inline-flex items-center gap-1 group/sub"
  >
    {sub.name}
    <button
      onClick={() => removeTechnique(sub.id)}
      className="opacity-0 group-hover/sub:opacity-100 transition-opacity text-red-400 hover:text-red-300"
      title="Remove from plan"
    >
      <Trash2 className="h-2.5 w-2.5" />
    </button>
  </span>
))}
```

For **transitions** (the `<div>` rows), add `group` to the existing row div and add a remove button at the end:
```tsx
<div key={technique.id} className="flex items-center gap-2 text-sm group">
  {/* existing TypeBadge, name, arrow, link content */}
  <button
    onClick={() => removeTechnique(technique.id)}
    className="ml-auto opacity-0 group-hover:opacity-100 transition-opacity text-muted-foreground hover:text-destructive shrink-0"
    title="Remove from plan"
  >
    <Trash2 className="h-3.5 w-3.5" />
  </button>
</div>
```

Note: The `group` class may conflict if there's a parent `group` — use `group/row` naming if needed to scope the hover properly.
  </action>
  <verify>Run `npx tsc --noEmit` — no errors. Run `npm run build` — succeeds. In dev server, hover over a technique node in the flowchart to confirm the "x" button appears. Click it to confirm it removes the technique without triggering drag.</verify>
  <done>Technique nodes in the flowchart show a remove button on hover that works without triggering drag. List view technique rows show a trash icon on hover. Both call `removeTechnique` from the store.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify complete Phase 2 plan management UI</name>
  <files>None — verification only</files>
  <action>
Human verifies the complete Phase 2 Plan Management UI visually and interactively. All automation is complete in Tasks 1-2 (this plan) and plans 02-01 and 02-02. This checkpoint confirms all CRUD operations, tag management, technique removal, and empty state work correctly.

What was built:
- Plan selector dropdown in the game plan page header showing active plan name
- Create dialog for naming a new game plan
- Rename dialog with pre-filled current name
- Delete AlertDialog with confirmation prompt
- Duplicate via copy icon (instant, no dialog)
- Tag toggle buttons (gi, no-gi, competition) for the active plan
- Read-only tag badges in plan selector dropdown per plan
- Remove button on technique nodes in the flowchart (hover-visible "x")
- Remove button on technique rows in the list view (hover-visible trash icon)
- Empty state with guidance when plan has no techniques

How to verify — run `npm run dev` and open the game plan page:

**Plan Selector (PLAN-01, PLAN-02):**
1. Verify a plan selector dropdown appears in the game plan page header showing the active plan name
2. Click the selector — verify the dropdown lists all plans with the active one highlighted
3. Click "New Plan" — verify a dialog opens asking for a name
4. Enter a name and submit — verify the new plan is created and becomes active (empty flowchart)
5. Click the selector again — verify both plans appear in the list

**Switching (PLAN-02):**
6. Switch back to the original plan — verify the flowchart shows the original plan's techniques
7. Switch to the new plan — verify it shows as empty

**Rename (PLAN-03):**
8. Click the pencil icon on a plan — verify the rename dialog opens with the current name pre-filled
9. Change the name and submit — verify the name updates in the selector

**Delete (PLAN-04):**
10. Click the trash icon on a plan — verify an AlertDialog appears asking for confirmation
11. Click "Cancel" — verify nothing is deleted
12. Click "Delete Plan" — verify the plan is removed and another plan becomes active

**Duplicate (PLAN-06):**
13. Click the copy icon on a plan — verify a new plan appears with "(copy)" suffix and the same techniques

**Tags (PLAN-07):**
14. Verify tag toggle buttons (gi, no-gi, competition) appear below the plan selector for the active plan
15. Click a tag — verify it toggles on (changes styling)
16. Click it again — verify it toggles off
17. Switch plans — verify tags are preserved per-plan
18. In the dropdown, verify tagged plans show small tag badges

**Technique Removal (INTX-03):**
19. With techniques in a plan, hover over a technique node in the flowchart — verify a small "x" button appears
20. Click the "x" — verify the technique is removed WITHOUT the node dragging
21. Switch to list view — hover over a technique row — verify a trash icon appears
22. Click the trash icon — verify the technique is removed

**Empty State (PLAN-05):**
23. Remove all techniques from a plan (or create a fresh empty plan) — verify the empty state message appears with guidance to browse techniques

Resume signal: Type "approved" or describe issues.
  </action>
  <verify>All 23 verification items pass. User types "approved".</verify>
  <done>Phase 2 Plan Management UI fully verified by human. All 8 requirements (PLAN-01 through PLAN-07, INTX-03) confirmed working.</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- `npm run build` succeeds
- All 23 verification items in the human-verify checkpoint pass
- All 8 Phase 2 requirements covered: PLAN-01 through PLAN-07 and INTX-03
</verification>

<success_criteria>
Complete Phase 2: users can create, switch, rename, delete, duplicate, and tag game plans. Users can remove individual techniques from the flowchart and list view. Empty plans show guidance. All operations persist across page refresh via Zustand persist.
</success_criteria>

<output>
After completion, create `.planning/phases/02-plan-management-ui/02-03-SUMMARY.md`
</output>
